<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Skigymnastik - iPad Ready</title>
    <style>
        /* --- GRUNDLAYOUT --- */
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4; 
            color: #000000;
            height: 100vh;
            width: 100vw;
            overflow: hidden; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* --- 1. FORTSCHRITTSBALKEN (GESAMTZEIT) --- */
        #progress-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            /* iPad Safe Area Support: Schiebt den Inhalt unter die Statusleiste */
            padding-top: env(safe-area-inset-top); 
            background-color: #333; /* Dunkler Hintergrund für den oberen Bereich */
            z-index: 9999; /* Immer ganz oben sichtbar */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        #progress-container {
            width: 100%;
            height: 6vh; /* Schön dick */
            background-color: #999; /* Dunkleres Grau für den leeren Teil */
            position: relative;
            border-bottom: 2px solid #000;
        }

        #progress-fill {
            height: 100%;
            width: 0%;
            background-color: #2980b9; /* Leuchtendes Blau */
            transition: width 0.5s linear;
        }
        
        #progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            text-align: center;
            font-size: 2.5vh;
            font-weight: bold;
            color: #fff; /* Weiße Schrift auf dem Balken */
            z-index: 21;
            pointer-events: none; 
            text-shadow: 1px 1px 2px #000;
        }

        /* --- 2. STATUS BALKEN (PHASE - Rot/Grün) --- */
        #status-bar {
            position: absolute;
            /* Rutscht automatisch unter den Progress Wrapper */
            top: calc(6vh + env(safe-area-inset-top)); 
            left: 0;
            width: 100%;
            height: 5vh; 
            background-color: #bdc3c7;
            transition: background-color 0.4s ease;
            z-index: 10;
        }
        
        /* Farben für Status */
        .bg-work { background-color: #27ae60 !important; } /* Grün */
        .bg-rest { background-color: #c0392b !important; } /* Rot */
        .bg-cool { background-color: #3498db !important; } /* Blau */
        .bg-wait { background-color: #f39c12 !important; } /* Orange */

        /* --- HAUPTKARTE --- */
        #timer-card {
            background: white;
            width: 98vw;  
            height: 84vh; 
            /* Mehr Abstand nach oben wegen Safe Area */
            margin-top: 14vh; 
            border: 0.4vh solid #000;
            border-radius: 2vh;
            box-shadow: 0 2vh 5vh rgba(0,0,0,0.2);
            
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; 
            position: relative;
            padding: 1vh;
            box-sizing: border-box;
        }

        /* --- PAUSE OVERLAY --- */
        .paused-state { opacity: 0.2; filter: grayscale(100%); }
        #paused-label {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20vh; 
            color: #fff;  
            background: rgba(192, 57, 43, 0.95); 
            padding: 3vh 6vh;
            border-radius: 3vh;
            z-index: 50;
            pointer-events: none; 
            box-shadow: 0 2vh 4vh rgba(0,0,0,0.5);
        }

        /* --- TYPOGRAFIE --- */
        
        /* Header */
        #header-section {
            width: 100%;
            text-align: center;
            border-bottom: 0.3vh solid #eee;
            padding-bottom: 0.5vh;
        }
        #phase-info { 
            text-transform: uppercase; font-size: 3.5vh; font-weight: 900; color: #444; letter-spacing: 0.2vh;
        }
        #round-info {
            font-size: 2.5vh; color: #666; font-style: italic; margin-top: 0.5vh; min-height: 3vh;
        }

        /* Main */
        #main-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin: -2vh 0; 
        }
        #exercise-title { 
            font-size: 7vh; 
            font-weight: 900; 
            line-height: 1.05; 
            text-align: center; 
            color: #000;
            margin-bottom: 1vh;
            max-width: 95%;
        }
        #timer-display { 
            font-size: 35vh; 
            font-weight: 800; 
            line-height: 0.9; 
            margin: 0; 
            font-variant-numeric: tabular-nums; 
            cursor: default;
            letter-spacing: -1vh;
        }

        /* Detail Box */
        #detail-section {
            width: 95%;
            background-color: #f0f0f0;
            border-radius: 2vh;
            padding: 2vh;
            text-align: center;
            border: 0.2vh solid #ccc;
            margin-bottom: 1vh;
        }

        #desc-text {
            font-size: 4vh; 
            font-weight: 600;
            color: #222; 
            margin-bottom: 1.5vh; 
            line-height: 1.2;
        }

        .info-grid {
            display: flex;
            justify-content: center;
            gap: 3vh;
            align-items: center;
            flex-wrap: wrap;
        }

        #variant-badge {
            background-color: #000; 
            color: #fff; 
            font-size: 3.5vh; 
            font-weight: bold; 
            padding: 1vh 3vh; 
            border-radius: 1vh;
        }
        
        #focus-box {
            font-size: 3.5vh; 
            font-weight: bold; 
            color: #c0392b; 
            border: 0.5vh solid #c0392b; 
            padding: 0.6vh 3vh; 
            border-radius: 1vh; 
            background: #fff;
        }

        /* Footer */
        #footer-section {
            width: 100%;
            text-align: center;
            padding-top: 1vh;
        }
        #next-up { 
            font-size: 3vh; 
            font-weight: 600;
            color: #333; 
        }

        /* --- BUTTONS --- */
        #start-container { position: absolute; top: 45%; width: 100%; text-align: center; z-index: 30; }
        #btnStart {
            font-size: 6vh; padding: 4vh 10vh; cursor: pointer; border: 0.5vh solid #000;
            background-color: #27ae60; color: #fff; font-weight: 900; text-transform: uppercase;
            border-radius: 2vh; box-shadow: 0 2vh 4vh rgba(0,0,0,0.4);
        }
        #btnStart:active { transform: scale(0.95); }

        #fab-container { position: fixed; bottom: 4vh; right: 4vh; z-index: 200; display: none; }
        .btn-fab {
            width: 14vh; height: 14vh; border-radius: 50%; border: 0.5vh solid #fff;
            cursor: pointer; color: #fff; font-size: 6vh; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 1vh 3vh rgba(0,0,0,0.4); outline: none; -webkit-tap-highlight-color: transparent;
        }
        #btnPause { background-color: #c0392b; }
        #btnResume { background-color: #27ae60; display: none; }

    </style>
</head>
<body>

<div id="progress-wrapper">
    <div id="progress-container">
        <div id="progress-text">GESAMTZEIT</div>
        <div id="progress-fill"></div>
    </div>
</div>

<div id="status-bar"></div>

<div id="timer-card">
    <div id="paused-label">⏸</div>
    
    <div id="card-content" style="width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: space-between;">
        
        <div id="header-section">
            <div id="phase-info">Vorbereitung</div>
            <div id="round-info">-</div>
        </div>

        <div id="main-section">
            <div id="exercise-title">Skigymnastik</div>
            <div id="timer-display" style="display:none">Start</div>
            
            <div id="start-container">
                <button id="btnStart">START</button>
            </div>
        </div>

        <div id="detail-section">
            <div id="desc-text">50 Minuten • Masterarbeit</div>
            <div class="info-grid">
                <div id="variant-badge" style="display:none">VAR A</div>
                <div id="focus-box" style="display:none">Fokus</div>
            </div>
        </div>

        <div id="footer-section">
            <div id="next-up">Gleich geht's los...</div>
        </div>
    </div>
</div>

<div id="fab-container">
    <button id="btnPause" class="btn-fab">⏸</button>
    <button id="btnResume" class="btn-fab">▶</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {

    // --- KONFIGURATION ---
    const TIME_WORK = 45;
    const TIME_REST = 15;
    const TIME_BLOCK_PAUSE = 60; 

    // --- WAKE LOCK ---
    let wakeLock = null;
    async function requestWakeLock() {
        try {
            if ('wakeLock' in navigator) {
                wakeLock = await navigator.wakeLock.request('screen');
            }
        } catch (err) { console.log(err); }
    }
    document.addEventListener('visibilitychange', async () => {
        if (wakeLock !== null && document.visibilityState === 'visible') await requestWakeLock();
    });

    // --- DATEN ---
    function step(n, d, v, f, p, dur, t, r = "") {
        return { name: n, desc: d, var: v, focus: f, phase: p, duration: dur, type: t, roundInfo: r };
    }

    const playlist = [];

    // === 1. ERWÄRMUNG ===
    const warmPhase = "1. Erwärmung";
    const warmups = [
        { n: "Gehen am Ort", d: "Am Platz gehen, Arme aktiv mitschwingen", v: "b) Knie höher ziehen", f: "-" },
        { n: "Seitl. Übersteigen", d: "Side Steps", v: "b) Mit Armkreisen", f: "-" },
        { n: "Hopserlauf", d: "Lockeres Hüpfen mit Armeinsatz", v: "a/b) Steigernd", f: "-" },
        { n: "Laufvariationen", d: "Lockeres Laufen im Kreis/am Ort", v: "a) Anfersen", f: "-" },
        { n: "Schulterkreisen", d: "Schultern kreisen beim Gehen", v: "c) Rückwärts", f: "-" },
        { n: "Rumpfrotation", d: "Arme vor Brust, Oberkörper rotieren", v: "b) Großer Radius", f: "-" },
        { n: "Fußgymnastik", d: "Aus dem Sprunggelenk federn", v: "b) Wechsel R/L", f: "-" },
        { n: "Mini-Kniebeugen", d: "Kleine Kniebeugen, Arme vor", v: "b) Mit Fersenheben", f: "-" }
    ];

    warmups.forEach(ex => {
        playlist.push(step(ex.n, ex.d, ex.v, ex.f, warmPhase, TIME_WORK, "work"));
        playlist.push(step("Pause", "Nächste Übung bereitmachen", "", "", warmPhase, TIME_REST, "rest"));
    });
    playlist.push(step("Block-Pause", "Trinken & Erklärung", "", "", "Pause", TIME_BLOCK_PAUSE, "wait"));


    // === 2. BLOCK A ===
    const phaseA = "2. Block A: Beinkraft";
    const blockA = [
        { n: "Kniebeugen tief", d: "Hüfte tief, Rücken gerade", v: "b) Arme über Kopf", f: "Beidbeinig" },
        { n: "Abfahrthocke", d: "Tiefe Skihocke einnehmen", v: "b) Federnd", f: "Beidbeinig" },
        { n: "Seitl. Ausfallschritte", d: "Großer Schritt zur Seite", v: "b) Mit Armvorhalte", f: "im Wechsel re/li" },
        { n: "Abfahrthocke statisch", d: "Tiefe Position halten", v: "a) Statisch halten", f: "Beidbeinig" }
    ];

    for (let r = 1; r <= 2; r++) {
        blockA.forEach(ex => {
            playlist.push(step(ex.n, ex.d, ex.v, ex.f, phaseA, TIME_WORK, "work", `Runde ${r} von 2`));
            playlist.push(step("Pause", "Lockern", "", "", phaseA, TIME_REST, "rest", `Runde ${r} von 2`));
        });
    }
    playlist.push(step("Block-Pause", "Vorbereitung Block B", "", "", "Pause", TIME_BLOCK_PAUSE, "wait"));


    // === 3. BLOCK B ===
    const phaseB = "3. Block B: Dynamik";
    for (let r = 1; r <= 2; r++) {
        playlist.push(step("Seitl. Skisprünge", "Sprünge von Bein zu Bein", "b) Große Distanz", "Wechselsprünge", phaseB, TIME_WORK, "work", `Runde ${r} von 2`));
        playlist.push(step("Pause", "Durchatmen", "", "", phaseB, TIME_REST, "rest", `Runde ${r} von 2`));
        
        let focusEinbein = (r === 1) ? "Runde 1: Rechts" : "Runde 2: Links";
        playlist.push(step("Einbeinstand & Schwung", "Schwungbein vor/zurück pendeln", "b) Diagonal", focusEinbein, phaseB, TIME_WORK, "work", `Runde ${r} von 2`));
        playlist.push(step("Pause", "Durchatmen", "", "", phaseB, TIME_REST, "rest", `Runde ${r} von 2`));

        playlist.push(step("Ausfallschritte vorw.", "Schritt vor, Knie senken", "c) Kniehub zurück", "im Wechsel re/li", phaseB, TIME_WORK, "work", `Runde ${r} von 2`));
        playlist.push(step("Pause", "Durchatmen", "", "", phaseB, TIME_REST, "rest", `Runde ${r} von 2`));

        playlist.push(step("Diag. Knie-Ellbogen", "Knie & Ellbogen zusammen", "b) Zügig", "im Wechsel re/li", phaseB, TIME_WORK, "work", `Runde ${r} von 2`));
        playlist.push(step("Pause", "Durchatmen", "", "", phaseB, TIME_REST, "rest", `Runde ${r} von 2`));
    }
    playlist.push(step("Block-Pause", "Vorbereitung Block C", "", "", "Pause", TIME_BLOCK_PAUSE, "wait"));


    // === 4. BLOCK C ===
    const phaseC = "4. Block C: Rumpf";
    for (let r = 1; r <= 2; r++) {
        playlist.push(step("Unterarmstütz", "Körper in Linie halten", "b) Bein heben", "Bein Wechsel", phaseC, TIME_WORK, "work", `Runde ${r} von 2`));
        playlist.push(step("Pause", "Wechsel", "", "", phaseC, TIME_REST, "rest", `Runde ${r} von 2`));
        
        playlist.push(step("Seitstütz (Rechts)", "Seitliche Stützposition", "c) Hüfte hoch", "Nur Rechts", phaseC, TIME_WORK, "work", `Runde ${r} von 2`));
        playlist.push(step("Pause", "Wechsel", "", "", phaseC, TIME_REST, "rest", `Runde ${r} von 2`));

        playlist.push(step("Seitstütz (Links)", "Seitliche Stützposition", "c) Hüfte hoch", "Nur Links", phaseC, TIME_WORK, "work", `Runde ${r} von 2`));
        playlist.push(step("Pause", "Wechsel", "", "", phaseC, TIME_REST, "rest", `Runde ${r} von 2`));

        let focusHocke = (r === 1) ? "Runde 1: Rechts" : "Runde 2: Links";
        playlist.push(step("Abfahrthocke einb.", "Ein Bein anheben, halten", "a) Abspreizen", focusHocke, phaseC, TIME_WORK, "work", `Runde ${r} von 2`));
        playlist.push(step("Pause", "Wechsel", "", "", phaseC, TIME_REST, "rest", `Runde ${r} von 2`));
    }
    playlist.push(step("Block-Pause", "Matte/Boden für Cool-down", "", "", "Pause", 30, "wait"));


    // === 5. COOL-DOWN ===
    const phaseCool = "5. Cool-down";
    const cooldowns = [
        { n: "Lockeres Ausschütteln", d: "Arme und Beine ausschütteln", v: "", f: "Alles lockern", t: 30 },
        { n: "Wadendehnung", d: "Schrittstellung, Ferse am Boden", v: "", f: "Rechts dann Links", t: 45 },
        { n: "Oberschenkelrückseite", d: "Bein vor, Oberkörper beugen", v: "", f: "Rechts dann Links", t: 45 },
        { n: "Adduktorendehnung", d: "Fußsohlen zusammen, Knie außen", v: "", f: "Statisch halten", t: 45 },
        { n: "Grätschsitz-Vorbeuge", d: "Oberkörper nach vorn/seitlich", v: "", f: "Mitte / Rechts / Links", t: 45 },
        { n: "Atemübung", d: "Tief ein- und ausatmen", v: "", f: "Augen schließen", t: 60 }
    ];

    cooldowns.forEach(ex => {
        playlist.push(step(ex.n, ex.d, ex.v, ex.f, phaseCool, ex.t, "cool"));
        playlist.push(step("Wechsel", "Locker bleiben", "", "", phaseCool, 5, "rest"));
    });


    // --- LOGIK ---
    let currentIdx = 0;
    let timeLeft = 0;
    let timer = null;
    let audioCtx = null;
    let isRunning = false; 

    const progressFill = document.getElementById('progress-fill');
    const statusBar = document.getElementById('status-bar');
    const display = document.getElementById('timer-display');
    const title = document.getElementById('exercise-title');
    const descText = document.getElementById('desc-text');
    const variantBadge = document.getElementById('variant-badge');
    const focusBox = document.getElementById('focus-box');
    const phaseDisp = document.getElementById('phase-info');
    const roundDisp = document.getElementById('round-info');
    const nextDisp = document.getElementById('next-up');
    
    const startContainer = document.getElementById('start-container');
    const btnStart = document.getElementById('btnStart');
    const fabContainer = document.getElementById('fab-container');
    const btnPause = document.getElementById('btnPause');
    const btnResume = document.getElementById('btnResume');
    const cardContent = document.getElementById('card-content');
    const pausedLabel = document.getElementById('paused-label');

    function initAudio() { try { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e){} }
    function playTone(freq, dur, type) {
        if (!audioCtx) return;
        try {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type || 'sine';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + dur);
        } catch(e){}
    }

    function updateUI() {
        if (currentIdx >= playlist.length) {
            finishWorkout();
            return;
        }

        const step = playlist[currentIdx];
        
        // Progress Logic
        const percentage = ((currentIdx) / playlist.length) * 100;
        progressFill.style.width = percentage + "%";

        display.innerText = timeLeft;
        title.innerText = step.name;
        descText.innerText = step.desc;
        phaseDisp.innerText = step.phase;
        roundDisp.innerText = step.roundInfo;

        if (step.var && step.var !== "") {
            variantBadge.innerText = step.var;
            variantBadge.style.display = "block";
        } else {
            variantBadge.style.display = "none";
        }

        if (step.focus && step.focus !== "" && step.focus !== "-") {
            focusBox.innerText = "Fokus: " + step.focus;
            focusBox.style.display = "block";
        } else {
            focusBox.style.display = "none";
        }

        statusBar.className = "";
        if (step.type === 'work') statusBar.classList.add('bg-work');
        else if (step.type === 'rest') statusBar.classList.add('bg-rest');
        else if (step.type === 'cool') statusBar.classList.add('bg-cool');
        else if (step.type === 'wait') statusBar.classList.add('bg-wait');

        let nextText = "Ende";
        for(let i = currentIdx + 1; i < playlist.length; i++) {
            if (playlist[i].type !== 'rest') {
                nextText = playlist[i].name;
                break;
            }
        }
        nextDisp.innerText = "Danach: " + nextText;
    }

    function tick() {
        if (timeLeft <= 3 && timeLeft > 0) playTone(600, 0.1, 'sine');
        
        timeLeft--;

        if (timeLeft < 0) {
            playTone(300, 0.6, 'square');
            currentIdx++;
            if (currentIdx >= playlist.length) {
                clearInterval(timer);
                finishWorkout();
                return;
            }
            timeLeft = playlist[currentIdx].duration;
            updateUI();
        } else {
            display.innerText = timeLeft;
        }
    }

    function startWorkout() {
        initAudio();
        requestWakeLock();
        if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();

        startContainer.style.display = "none";
        display.style.display = "block";
        fabContainer.style.display = "block";

        timeLeft = playlist[currentIdx].duration;
        updateUI();

        isRunning = true;
        timer = setInterval(tick, 1000);
    }

    function pauseTimer() {
        if (!isRunning) return;
        clearInterval(timer);
        isRunning = false;
        btnPause.style.display = "none";
        btnResume.style.display = "flex";
        cardContent.classList.add("paused-state");
        pausedLabel.style.display = "block";
    }

    function resumeTimer() {
        if (isRunning) return;
        if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
        requestWakeLock();
        btnPause.style.display = "flex";
        btnResume.style.display = "none";
        cardContent.classList.remove("paused-state");
        pausedLabel.style.display = "none";
        isRunning = true;
        timer = setInterval(tick, 1000);
    }

    function finishWorkout() {
        statusBar.className = "";
        phaseDisp.innerText = "SEMINAR BEENDET";
        progressFill.style.width = "100%";
        title.innerText = "Vielen Dank!";
        descText.innerText = "Super mitgemacht.";
        variantBadge.style.display = "none";
        focusBox.style.display = "none";
        display.innerText = "✔";
        nextDisp.innerText = "";
        fabContainer.style.display = "none";
    }

    if(btnStart) btnStart.addEventListener('click', startWorkout);
    if(btnPause) btnPause.addEventListener('click', pauseTimer);
    if(btnResume) btnResume.addEventListener('click', resumeTimer);
});
</script>
</body>
</html>
